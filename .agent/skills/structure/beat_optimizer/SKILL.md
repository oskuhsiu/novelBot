---
name: beat_optimizer
description: 細目動態優化器 - 優化節拍張力值，強化劇情節奏與埋設伏筆
---

# 細目動態優化器 (Beat Optimizer)

## 功能概述

此 Skill 在節拍（Beats）生成後進行優化，確保：
1. 張力分布合理（有起有伏）
2. 內容不空洞（根據權重填充具體細節）
3. 伏筆被適當植入

## 核心功能

### 1. 張力值分析
檢查節拍序列的「張力曲線」，避免平淡或過度緊張

### 2. 內容強化
根據 `content_weights`，為節拍補充具體的演繹素材

### 3. 伏筆植入
從記憶庫提取 `open_foreshadowing`，選擇合適的節拍埋入線索

## 輸入

1. 從 `templates/narrative_progress.yaml` 讀取：
   - 當前章節的 `beats` 列表

2. 從 `templates/novel_config.yaml` 讀取：
   - `content_weights`

3. 從記憶庫讀取（如果存在）：
   - `open_foreshadowing`：待回收的伏筆

## 輸出

優化後的 `beats` 列表，增加：
- `tension_level`：張力值（1-10）
- `enhancement_notes`：強化建議
- `foreshadowing_seed`：植入的伏筆

## 執行步驟

### Step 1: 分析當前節拍
```
讀取章節的所有節拍：{{beats_list}}

對每個節拍評估：
- 內容類型：戰鬥/對話/探索/etc.
- 預期張力：高/中/低
- 情緒走向：正/負
```

### Step 2: 計算張力曲線
```
## 張力值評估標準

【張力 1-3：低張力】
- 日常場景、休息、閒聊
- 讀者可以放鬆

【張力 4-6：中張力】
- 情報交換、計畫討論、輕微衝突
- 維持興趣但不緊繃

【張力 7-9：高張力】
- 戰鬥、危機、重大抉擇
- 讀者屏息以待

【張力 10：極致張力】
- 生死關頭、最終揭露
- 慎用，每章最多一次

## 曲線優化

理想的張力曲線應該：
- 開場：中張力（3-5）快速吸引
- 發展：起伏變化（4-7）
- 高潮：上升到峰值（8-10）
- 收尾：略微下降但留懸念（5-7）

檢查問題：
- 連續低張力 > 2 個節拍：建議加入衝突
- 連續高張力 > 3 個節拍：建議插入緩衝
- 結尾張力太低：建議強化懸念
```

### Step 3: 內容強化建議
```
根據 content_weights，為每個節拍提供具體化建議：

## 戰鬥權重高時
若節拍涉及衝突，建議加入：
- 具體的招式細節（從 power_system 抓取）
- 環境物理損毀
- 體力/能量消耗

## 對話權重高時
若節拍涉及交流，建議加入：
- 潛台詞設計
- 肢體語言暗示
- 階層/勢力用語差異

## 環境權重高時
若節拍涉及移動/探索，建議加入：
- 五感細節
- 隱藏的細節暗示
- 與劇情相關的環境互動
```

### Step 4: 伏筆植入
```
讀取待回收伏筆列表：{{open_foreshadowing}}

對每個伏筆：
- 評估是否適合在本章植入線索
- 選擇最自然的節拍
- 設計隱晦的暗示方式

## 伏筆植入原則

1. **自然融入**：線索應該看起來像普通描寫
2. **多次暗示**：重要伏筆應該多次輕觸
3. **回顧感**：揭曉時讀者回想應該有「原來如此」之感

## 範例
伏筆：「妹妹的意識備份中藏有禁忌代碼」
植入方式：主角讀取硬盤時，「某個數據區塊閃過父親熟悉的編碼風格，轉瞬即逝」
```

### Step 5: 輸出優化結果
```yaml
optimized_beats:
  - id: "B1_1"
    summary: "..."
    tension_level: 4
    enhancement_notes:
      - "加入黑市的聲音細節：叫賣聲、機械嗡響"
      - "描寫空氣中的氣味：油煙、廉價香水"
    foreshadowing_seed: null
    
  - id: "B1_2"
    summary: "..."
    tension_level: 6
    enhancement_notes:
      - "對話加入潛台詞：神秘人在試探主角"
      - "硬盤讀取的視覺效果要具體"
    foreshadowing_seed:
      ref_id: "FORE_001"
      hint: "數據流中閃過一瞬間的熟悉感"
```

## 張力曲線視覺化

```
章節張力曲線建議：

節拍 1: ████░░░░░░ (4) - 環境鋪陳
節拍 2: ██████░░░░ (6) - 交易進行
節拍 3: ████████░░ (8) - 突發意外
節拍 4: ██████████ (10) - 高潮衝突
節拍 5: ███████░░░ (7) - 懸念收尾
```

## 使用時機

- **節拍生成後**：優化章節結構
- **寫作前檢查**：確保內容有料
- **伏筆管理**：定期檢查伏筆植入

## 與其他 Skill 的關聯

- **前置**：`skill_chapter_beater`（需要節拍列表）
- **讀取**：`skill_lorekeeper`（獲取伏筆列表）
- **輸出到**：`skill_scene_writer`（提供增強建議）

## 注意事項

1. **張力不是越高越好**：持續高張力會讓讀者疲勞
2. **強化是建議**：Scene Writer 可以選擇性採用
3. **伏筆要克制**：每章最多植入 1-2 個新伏筆
4. **類型匹配**：輕鬆喜劇的張力曲線與嚴肅懸疑不同
